


ARM Macro Assembler    Page 1 


    1 00000000         ; LPC2148 ADC and GPIO-based LED control program
    2 00000000         ; Fully commented and rearranged for clarity
    3 00000000                 AREA             RESET, CODE, READONLY
    4 00000000                 ENTRY
    5 00000000         
    6 00000000         
    7 00000000         ; ADC and GPIO Registers
    8 00000000 E002C004 
                       PINSEL1 EQU              0xE002C004  ; PINSEL1 register 
                                                            address
    9 00000000 E0028008 
                       IO0DIR  EQU              0xE0028008  ; GPIO direction re
                                                            gister (P0)
   10 00000000 E0028004 
                       IO0SET  EQU              0xE0028004  ; GPIO set register
                                                             (P0)
   11 00000000 E002800C 
                       IO0CLR  EQU              0xE002800C  ; GPIO clear regist
                                                            er (P0)
   12 00000000 E0034000 
                       AD0CR   EQU              0xE0034000  ; ADC control regis
                                                            ter
   13 00000000 E0034014 
                       AD0DR1  EQU              0xE0034014  ; ADC data register
                                                             for Channel 0
   14 00000000         
   15 00000000         
   16 00000000         ; Main Program Entry Point
   17 00000000         main
   18 00000000 EB000003        BL               LED_INIT    ; Initialize LEDs (
                                                            GPIO)
   19 00000004 EB000008        BL               ADC_INIT    ; Initialize ADC
   20 00000008 EAFFFFFF        B                loop        ; Enter main loop
   21 0000000C         
   22 0000000C         
   23 0000000C         ; Main Loop 
   24 0000000C         loop
   25 0000000C EB00000D        BL               ADC_START   ; Start ADC convers
                                                            ion
   26 00000010 EAFFFFFD        B                loop        ; Repeat forever
   27 00000014         
   28 00000014         ; LED Initialization Subroutine
   29 00000014         ; Configures GPIO P0.0 to P0.9 as output for LEDs
   30 00000014         LED_INIT
   31 00000014 E59F008C        LDR              R0, =IO0DIR ; Load address of G
                                                            PIO direction regis
                                                            ter
   32 00000018 E5901000        LDR              R1 , [R0]   ; Read current GPIO
                                                             direction configur
                                                            ation
   33 0000001C E59F2088        LDR              R2,=0x000003FF ; Mask for P0.0 
                                                            to P0.9 (LED pins)
   34 00000020 E1811002        ORR              R1, R1, R2  ; Set P0.0 to P0.9 
                                                            as output (IO0DIR |
                                                            = 0x3FF)
   35 00000024 E5801000        STR              R1, [R0]    ; Store updated dir
                                                            ection configuratio
                                                            n
   36 00000028 E12FFF1E        BX               LR          ; Return from subro



ARM Macro Assembler    Page 2 


                                                            utine
   37 0000002C         
   38 0000002C         ; ADC Initialization Subroutine
   39 0000002C         ; Configures P0.28 as AD0.1 and sets up ADC for 10-bit c
                       onversion
   40 0000002C         ADC_INIT
   41 0000002C E59F007C        LDR              R0, =PINSEL1 ; Load address of 
                                                            PINSEL1 register
   42 00000030 E3A01401        LDR              R1, =0x01000000 ; Configure P0.
                                                            28 as AD0.1
   43 00000034 E5801000        STR              R1, [R0]    ; Store pin configu
                                                            ration
   44 00000038         
   45 00000038         ; AD0CR --> ADC operational, 10-bits, 11 clocks for conv
                       ersion 
   46 00000038 E59F0074        LDR              R0, =AD0CR  ; Load address of A
                                                            DC control register
                                                             
   47 0000003C E59F1074        LDR              R1, =0x00200402 ; Enable ADC, 1
                                                            0-bit resolution, 1
                                                            1 clock cycles
   48 00000040 E5801000        STR              R1, [R0]    ; Store ADC configu
                                                            ration
   49 00000044 EBFFFFF0        BL               loop        ; Return from subro
                                                            utine
   50 00000048         
   51 00000048         ; ADC Start Subroutine
   52 00000048         ; Starts the ADC conversion process
   53 00000048         ADC_START
   54 00000048         ; Start Conversion
   55 00000048 E59F0064        LDR              R0, =AD0CR  ; Load address of A
                                                            DC control register
                                                            
   56 0000004C E5901000        LDR              R1, [R0]    ; Read current ADC 
                                                            control configurati
                                                            on
   57 00000050 E3811401        ORR              R1, R1, #(1 << 24) ; Set START 
                                                            bit (bit 24) to ini
                                                            tiate conversion
   58 00000054 E5801000        STR              R1, [R0]    ; Wait for conversi
                                                            on to complete
   59 00000058         
   60 00000058 EB000008        BL               wait_adc    ; Wait for conversi
                                                            on to complete
   61 0000005C         
   62 0000005C         
   63 0000005C         ; ADC Wait Subroutine
   64 0000005C         ; Polls ADC until conversion is complete
   65 0000005C         ADC_READ
   66 0000005C E1A00320        LSR              R0, R0, #6  ; result = (result>
                                                            >6);
   67 00000060         
   68 00000060         
   69 00000060 E59F1044        LDR              R1,=0x000003FF ; result = (resu
                                                            lt & 0x000003FF);
   70 00000064 E0000001        AND              R0, R1      ;R0 Store result
   71 00000068 E59F304C        LDR              R3 ,=0xE002800C
   72 0000006C E59F1038        LDR              R1,=0x3FF
   73 00000070 E5831000        STR              R1 , [R3]   ; CLEAR IO PINS 



ARM Macro Assembler    Page 3 


   74 00000074 E59F2044        LDR              R2, =IO0SET
   75 00000078 E5820000        STR              R0,[R2]     ; SET NEW VALUE 
   76 0000007C EBFFFFF1        BL               ADC_START
   77 00000080         
   78 00000080         
   79 00000080         wait_adc
   80 00000080 E59F003C        LDR              R0,=0xE0034004 ; Load address o
                                                            f AD0GDR (global AD
                                                            C data register)
   81 00000084 E5900000        LDR              R0 , [R0]   ; Read current valu
                                                            e of AD0GDR
   82 00000088 E3100102        TST              R0, #0x80000000 ; Test if conve
                                                            rsion complete (bit
                                                             31 is set)
   83 0000008C 0AFFFFFB        BEQ              wait_adc    ; If not complete, 
                                                            keep polling
   84 00000090         ;Make START Bit 0
   85 00000090 E59F101C        LDR              R1 , =AD0CR ; Load address of A
                                                            DC control registe
   86 00000094 E5912000        LDR              R2, [R1]    ; Read current ADC 
                                                            control configurati
                                                            on
   87 00000098 E59F3028        LDR              R3,=0xFEFFFFFF ; Clear START bi
                                                            t (bit 24)
   88 0000009C E0022003        AND              R2,R3
   89 000000A0 E5812000        STR              R2,[R1]     ; Store updated con
                                                            figuration
   90 000000A4 1AFFFFEC        BNE              ADC_READ    ; Proceed to read A
                                                            DC value
   91 000000A8         
   92 000000A8                 END
              E0028008 
              000003FF 
              E002C004 
              E0034000 
              00200402 
              E002800C 
              E0028004 
              E0034004 
              FEFFFFFF 
Command Line: --debug --xref --apcs=interwork --depend=.\main.d -o.\main.o -IC:
\Keil\ARM\RV31\INC -IC:\Keil\ARM\CMSIS\Include -IC:\Keil\ARM\Inc\Philips --pred
efine="__EVAL SETA 1" --list=.\main.lst Main.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

ADC_INIT 0000002C

Symbol: ADC_INIT
   Definitions
      At line 40 in file Main.s
   Uses
      At line 19 in file Main.s
Comment: ADC_INIT used once
ADC_READ 0000005C

Symbol: ADC_READ
   Definitions
      At line 65 in file Main.s
   Uses
      At line 90 in file Main.s
Comment: ADC_READ used once
ADC_START 00000048

Symbol: ADC_START
   Definitions
      At line 53 in file Main.s
   Uses
      At line 25 in file Main.s
      At line 76 in file Main.s

LED_INIT 00000014

Symbol: LED_INIT
   Definitions
      At line 30 in file Main.s
   Uses
      At line 18 in file Main.s
Comment: LED_INIT used once
RESET 00000000

Symbol: RESET
   Definitions
      At line 3 in file Main.s
   Uses
      None
Comment: RESET unused
loop 0000000C

Symbol: loop
   Definitions
      At line 24 in file Main.s
   Uses
      At line 20 in file Main.s
      At line 26 in file Main.s
      At line 49 in file Main.s

main 00000000

Symbol: main
   Definitions
      At line 17 in file Main.s
   Uses
      None
Comment: main unused



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Relocatable symbols

wait_adc 00000080

Symbol: wait_adc
   Definitions
      At line 79 in file Main.s
   Uses
      At line 60 in file Main.s
      At line 83 in file Main.s

8 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

AD0CR E0034000

Symbol: AD0CR
   Definitions
      At line 12 in file Main.s
   Uses
      At line 46 in file Main.s
      At line 55 in file Main.s
      At line 85 in file Main.s

AD0DR1 E0034014

Symbol: AD0DR1
   Definitions
      At line 13 in file Main.s
   Uses
      None
Comment: AD0DR1 unused
IO0CLR E002800C

Symbol: IO0CLR
   Definitions
      At line 11 in file Main.s
   Uses
      None
Comment: IO0CLR unused
IO0DIR E0028008

Symbol: IO0DIR
   Definitions
      At line 9 in file Main.s
   Uses
      At line 31 in file Main.s
Comment: IO0DIR used once
IO0SET E0028004

Symbol: IO0SET
   Definitions
      At line 10 in file Main.s
   Uses
      At line 74 in file Main.s
Comment: IO0SET used once
PINSEL1 E002C004

Symbol: PINSEL1
   Definitions
      At line 8 in file Main.s
   Uses
      At line 41 in file Main.s
Comment: PINSEL1 used once
6 symbols
347 symbols in table
